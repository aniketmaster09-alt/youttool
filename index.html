<!DOCTYPE html>
<html>
<head>
    <title>YouTube Downloader</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 20px auto; padding: 20px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #ff0000; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .video-info { display: flex; gap: 20px; margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .thumbnail { width: 200px; height: 150px; object-fit: cover; border-radius: 5px; }
        .info { flex: 1; }
        .formats { margin: 20px 0; }
        .format-section { margin: 15px 0; }
        .format-section h4 { margin: 10px 0 5px 0; color: #333; }
        .format-link { display: block; padding: 8px; margin: 2px 0; background: #f5f5f5; text-decoration: none; color: #333; border-radius: 3px; }
        .format-link:hover { background: #e0e0e0; }
        .loading { text-align: center; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>YouTube Downloader</h1>
    <input type="url" id="url" placeholder="YouTube URL" value="https://youtu.be/ZCzWNZlwmD0?si=v-Kcw8q9rQDXzD2i">
    <button onclick="download()">Get Formats</button>
    <div id="loading" class="loading" style="display:none;">Processing...</div>
    <div id="result"></div>

    <script>
        // Set cookies for bot detection bypass
        function setCookies() {
            const hostname = window.location.hostname;
            const domain = hostname.startsWith('www.') ? hostname.substring(4) : hostname;
            const expires = new Date(Date.now() + 365*24*60*60*1000).toUTCString();
            
            document.cookie = `_ga=GA1.1.584190117.1762224553; path=/; domain=.${domain}; expires=${expires}; SameSite=Lax`;
            document.cookie = `_ga_2HS60D2GS7=GS2.1.s1762224553$o1$g1$t1762226302$j50$l0$h0; path=/; domain=.${domain}; expires=${expires}; SameSite=Lax`;
            document.cookie = `CONSENT=YES+cb.20210328-17-p0.en+FX+${Math.floor(Math.random() * 999)}; path=/; expires=${expires}; SameSite=Lax`;
        }
        
        // Set cookies on page load
        setCookies();
        
        async function download() {
            const url = document.getElementById('url').value;
            const result = document.getElementById('result');
            const loading = document.getElementById('loading');
            
            loading.style.display = 'block';
            result.innerHTML = '';
            
            try {
                const response = await fetch('/.netlify/functions/download', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'User-Agent': navigator.userAgent
                    },
                    credentials: 'include',
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                
                if (!data.error) {
                    // Video info section
                    result.innerHTML = `
                        <div class="video-info">
                            <img src="${data.thumbnail}" alt="Thumbnail" class="thumbnail">
                            <div class="info">
                                <h3>${data.title}</h3>
                                <p><strong>Author:</strong> ${data.author}</p>
                                <p><strong>Duration:</strong> ${Math.floor(data.duration/60)}:${(data.duration%60).toString().padStart(2,'0')}</p>
                                <p><strong>Formats found:</strong> ${data.medias.length}</p>
                            </div>
                        </div>
                    `;
                    
                    // Separate formats
                    const videoWithAudio = data.medias.filter(m => m.type === 'video' && m.is_audio);
                    const videoOnly = data.medias.filter(m => m.type === 'video' && !m.is_audio);
                    const audioOnly = data.medias.filter(m => m.type === 'audio');
                    
                    let formatsHtml = '<div class="formats">';
                    
                    if (videoWithAudio.length > 0) {
                        formatsHtml += '<div class="format-section"><h4>Videos (With Audio)</h4>';
                        videoWithAudio.forEach(media => {
                            formatsHtml += `<a href="${media.url}" download="${data.title}.${media.ext}" class="format-link">${media.quality} - ${media.formatId}</a>`;
                        });
                        formatsHtml += '</div>';
                    }
                    
                    if (videoOnly.length > 0) {
                        formatsHtml += '<div class="format-section"><h4>Videos (No Audio)</h4>';
                        videoOnly.forEach(media => {
                            formatsHtml += `<a href="${media.url}" download="${data.title}.${media.ext}" class="format-link">${media.quality} - ${media.formatId}</a>`;
                        });
                        formatsHtml += '</div>';
                    }
                    
                    if (audioOnly.length > 0) {
                        formatsHtml += '<div class="format-section"><h4>Audios</h4>';
                        audioOnly.forEach(media => {
                            formatsHtml += `<a href="${media.url}" download="${data.title}.${media.ext}" class="format-link">${media.quality} - ${media.formatId}</a>`;
                        });
                        formatsHtml += '</div>';
                    }
                    
                    formatsHtml += '</div>';
                    result.innerHTML += formatsHtml;
                } else {
                    result.innerHTML = `<div style="color:red;">Error: ${data.message || data.error}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div style="color:red;">Error: ${error.message}</div>`;
            }
            
            loading.style.display = 'none';
        }
    </script>
</body>
</html>